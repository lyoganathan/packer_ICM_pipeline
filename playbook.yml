#Ansible playbook for setting up ubuntu-desktop, freesurfer 6.0, and FSL & ITK Snap
---
- hosts: all
  vars:
    ansible_python_interpreter: /usr/bin/python3
  become: yes
  tasks:
  - name: Source neurodebian
    get_url:
      url: http://neuro.debian.net/lists/xenial.au.full
      dest: /etc/apt/sources.list.d/neurodebian.sources.list
  - name: apt keys
    apt_key:
      url: http://keyserver.ubuntu.com/pks/lookup?op=get&fingerprint=on&search=0xA5D32F012649A5A9
      state: present
  - name: kill automatic updating script, if any
    command: pkill --full /usr/bin/unattended-upgrade
    register: kill_result
    failed_when: kill_result.rc > 1 # rc == 1 if the script is inactive
    changed_when: kill_result.rc == 0
  - name: Install ubuntu-desktop
    apt:
      name: ubuntu-desktop
      state: present
      update_cache: yes
    register: task_result
    until: task_result|succeeded
    retries: 5
    delay: 3
    ignore_errors: yes
  - name: update apt
    command: "apt-get update"
  - name: Install FSL
    apt:
      name: '{{ item }}'
      state: present
    with_items:
      - fsl-complete
  - name: Install ITK snap
    command: "tar -C /usr/local -zxvf /home/vagrant/itksnap-3.6.0-20170401-Linux-x86_64.tar.gz"
  - name: Install freesurfer
    command: "tar -C /usr/local -xzvf /home/vagrant/freesurfer-Linux-centos6_x86_64-stable-pub-v6.0.0.tar.gz"
...
